{% extends 'newref/base.html' %}
{% load static %}
{% load crispy_forms_tags %}


{% block title %}Couture en tête{% endblock %}

{% block head %}

{% endblock %}


{% block content %}

<div>Ceci est la page de vote de {{rawvote.email}}. Ne partagez pas cette URL : une personne en disposant pourrait modifier vos réponses.</div>
<h3 class="mt-4 mb-4">{{ref.text}}</h3>

{% if rawvote.json %}
<div id="alert_ok" class="alert alert-primary">
	Vos réponses sont bien enregistrées. 

	<button type="button" class="btn btn-outline-primary" data-toggle="modal" data-target="#exampleModal">
	  Effacer mes réponses
	</button>

	<!-- Modal -->
	<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
	        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	          <span aria-hidden="true">&times;</span>
	        </button>
	      </div>
	      <div class="modal-body">
	        Vous confirmez souhaiter effacer vos réponses ?
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-primary"  onclick="location.href = '{% url 'votedelete' rawvote.code %}';">Oui</button>
	        <button type="button" class="btn btn-secondary" data-dismiss="modal">Non</button>
	      </div>
	    </div>
	  </div>
	</div>


</div>

{% else %}
<div id="alert_empty" class="alert alert-secondary">
	Vous n'avez pas de réponses enregistrées.
</div>
{% endif %}

<div id="alert_nok" class="alert alert-warning">
	Attention, vos réponses ne sont pas enregistrées.
</div>

<script type="text/javascript">
	/* lists contient toutes les instances de sortable*/
	var lists = {};
	$('#alert_nok').hide();

</script>

{% for question in ref.questions %}

	<div class="mt-4 mb-4"><b>{{question.text}}</b></div>

	{% for option in question.options %}
		<div class="form-check ml-2">
		<input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
		<label class="form-check-label" for="exampleRadios1">
			Default radio
		</label>
		</div>
	{% endfor %}

	<ul id="q{{question.id}}" class="list-group">
		{% for option in question.options %}
		<li id="{{option.id}}" class="list-group-item">{{option.text}}</a></li>
		{% endfor %}
	</ul>

{% endfor %}

<form method="post" action="{% url 'votepage' rawvote.code %}">
	{% csrf_token %}
	{{form|crispy}}
	<button id ="savebut" type="submit" class="btn btn-outline-primary btn-lg mt-4" disabled><span id="spinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Enregistrer</button>
</form>

<script type="text/javascript">
	//Le spinner (déco)
	$("#spinner").hide();
	$("#savebut").click(function() {
		$("#spinner").show();
	});

	//
	function getOrders() {
		json = {};
		for (const[key,value] of Object.entries(lists)) {
			json[key]=value.toArray();
		};
		$('[name="json"]').val(JSON.stringify(json));
		$('.alert').hide();
		$('#alert_nok').show();
		$('#savebut').attr("class","btn btn-warning btn-lg mt-4")
		$("#savebut").prop("disabled",false);
	};



</script>

{% endblock %}